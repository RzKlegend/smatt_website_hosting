<!DOCTYPE html>
<!--
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                   BATCH PHOTO ATTENDANCE SYSTEM                              ‚ïë
‚ïë                         Camera Access Setup                                   ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

‚ö†Ô∏è IMPORTANT: This app requires HTTPS to access the camera!

‚úÖ WORKING METHODS:
   1. Run locally by opening HTML file directly (file://)
   2. Deploy with HTTPS using free services below

‚ùå NOT WORKING:
   √ó HTTP websites (http://) - Camera blocked by browser!

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üöÄ HOW TO DEPLOY WITH HTTPS (Pick One):

üìå OPTION 1: GitHub Pages (Recommended)
   1. Create GitHub account (free)
   2. Create new repository
   3. Upload this file as "index.html"
   4. Go to Settings ‚Üí Pages ‚Üí Deploy
   5. Get HTTPS link: https://username.github.io/repo-name/

üìå OPTION 2: Netlify Drop (Fastest - 30 seconds!)
   1. Go to: https://app.netlify.com/drop
   2. Drag and drop this HTML file
   3. Get instant HTTPS link!

üìå OPTION 3: Vercel (Also Free)
   1. Go to: https://vercel.com
   2. Sign up free
   3. Deploy this file
   4. Get HTTPS link instantly

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üí° TIP: If you just want to test locally, simply:
   ‚Üí Double-click this HTML file
   ‚Üí It will open in your browser and work!

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Batch Photo Attendance System - Debug Mode</title>
    <script src="https://cdn.jsdelivr.net/npm/@vladmandic/face-api@1.7.12/dist/face-api.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .workflow {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .workflow-step {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .workflow-step .number {
            background: #667eea;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2em;
            margin: 0 auto 10px;
        }

        .workflow-step.active .number {
            background: #28a745;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .workflow-step h3 {
            color: #667eea;
            font-size: 1em;
            margin-bottom: 5px;
        }

        .workflow-step p {
            font-size: 0.85em;
            color: #666;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .upload-zone {
            border: 3px dashed #667eea;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #f8f9fa;
        }

        .upload-zone:hover {
            background: #e9ecef;
            border-color: #764ba2;
        }

        .upload-zone.dragover {
            background: #d4edda;
            border-color: #28a745;
        }

        .upload-zone .icon {
            font-size: 4em;
            margin-bottom: 15px;
        }

        .upload-zone h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .upload-zone p {
            color: #666;
            font-size: 0.9em;
        }

        #fileInput {
            display: none;
        }

        .video-container {
            position: relative;
            background: #000;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        #video {
            width: 100%;
            display: block;
            border-radius: 10px;
        }

        #canvas {
            position: absolute;
            top: 0;
            left: 0;
        }

        .detection-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px;
            font-family: monospace;
            font-size: 0.9em;
            max-height: 150px;
            overflow-y: auto;
        }

        .detection-overlay div {
            margin-bottom: 5px;
        }

        .status {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 600;
            text-align: center;
        }

        .status.loading {
            background: #fff3cd;
            color: #856404;
        }

        .status.ready {
            background: #d4edda;
            color: #155724;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
        }

        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        button {
            padding: 15px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        button:active:not(:disabled) {
            transform: translateY(0);
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-warning {
            background: #ffc107;
            color: #000;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .uploaded-photos {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .photo-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            transition: transform 0.3s;
        }

        .photo-card:hover {
            transform: scale(1.05);
        }

        .photo-card img {
            width: 100%;
            height: 100px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .photo-card .id {
            font-weight: bold;
            color: #667eea;
            font-size: 0.9em;
            margin-bottom: 3px;
        }

        .photo-card .name {
            font-size: 0.85em;
            color: #333;
            word-break: break-word;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 2.5em;
            margin-bottom: 5px;
        }

        .stat-card p {
            opacity: 0.9;
            font-size: 1em;
        }

        .attendance-lists {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .attendance-list {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
        }

        .attendance-list h3 {
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .attendance-list.present h3 {
            color: #28a745;
        }

        .attendance-list.absent h3 {
            color: #dc3545;
        }

        .attendance-list .person {
            background: white;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .attendance-list .person .icon {
            font-size: 1.5em;
        }

        .attendance-list .person .info {
            flex: 1;
        }

        .attendance-list .person .id {
            font-weight: bold;
            color: #667eea;
        }

        .attendance-list .person .name {
            color: #666;
            font-size: 0.9em;
        }

        .attendance-list .person .time {
            font-size: 0.85em;
            color: #999;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .empty-state .icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .log {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.85em;
        }

        .log-entry {
            padding: 5px;
            margin-bottom: 5px;
            border-left: 3px solid #667eea;
            padding-left: 10px;
        }

        .log-entry.success {
            border-left-color: #28a745;
            color: #155724;
        }

        .log-entry.error {
            border-left-color: #dc3545;
            color: #721c24;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .workflow {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .icon {
            font-size: 1.2em;
        }

        .progress-bar {
            background: #e9ecef;
            border-radius: 10px;
            height: 30px;
            margin: 15px 0;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìö Batch Photo Attendance System</h1>
            <p>Upload Photos ‚Üí Train AI ‚Üí Auto-Mark Attendance (Debug Mode)</p>
        </div>

        <div class="workflow">
            <div class="workflow-step active" id="step1">
                <div class="number">1</div>
                <h3>Upload Photos</h3>
                <p>Add student photos</p>
            </div>
            <div class="workflow-step" id="step2">
                <div class="number">2</div>
                <h3>Training</h3>
                <p>AI learns faces</p>
            </div>
            <div class="workflow-step" id="step3">
                <div class="number">3</div>
                <h3>Recognition</h3>
                <p>Camera detects faces</p>
            </div>
            <div class="workflow-step" id="step4">
                <div class="number">4</div>
                <h3>Report</h3>
                <p>View attendance</p>
            </div>
        </div>

        <div id="systemStatus" class="status loading">
            <span class="icon">‚è≥</span> Loading AI models...
        </div>

        <div class="main-content">
            <!-- Left Column: Upload & Training -->
            <div>
                <div class="card">
                    <h2><span class="icon">üì§</span> Step 1: Upload Student Photos</h2>
                    
                    <div class="upload-zone" id="uploadZone">
                        <div class="icon">üìÅ</div>
                        <h3>Drag & Drop Photos Here</h3>
                        <p>or click to browse files</p>
                        <p style="margin-top: 10px; font-size: 0.85em;">
                            Format: <strong>ID_Name.jpg</strong> (e.g., "101_John_Doe.jpg")
                        </p>
                    </div>
                    <input type="file" id="fileInput" multiple accept="image/*">

                    <div id="trainingProgress" style="display: none;">
                        <h3 style="color: #667eea; margin-top: 20px;">Training Progress</h3>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill">0%</div>
                        </div>
                    </div>

                    <div class="controls" style="margin-top: 20px;">
                        <button id="trainBtn" class="btn-success" disabled>
                            <span class="icon">üéì</span> Train AI on Photos
                        </button>
                        <button id="clearBtn" class="btn-danger">
                            <span class="icon">üóëÔ∏è</span> Clear All
                        </button>
                    </div>

                    <div id="uploadedPhotos" class="uploaded-photos"></div>
                </div>

                <div class="card" style="margin-top: 20px;">
                    <h2><span class="icon">üìã</span> Real-Time Debug Log</h2>
                    <div id="activityLog" class="log">
                        <div class="log-entry">System initialized. Upload photos to begin.</div>
                    </div>
                </div>
            </div>

            <!-- Right Column: Camera & Results -->
            <div>
                <div class="card">
                    <h2><span class="icon">üì∑</span> Step 2: Live Attendance</h2>
                    
                    <div class="video-container">
                        <video id="video" autoplay muted playsinline webkit-playsinline></video>
                        <canvas id="canvas"></canvas>
                        <div id="detectionOverlay" class="detection-overlay" style="display: none;">
                            <div><strong>Detection Info:</strong></div>
                        </div>
                    </div>

                    <div class="controls">
                        <button id="startAttendance" class="btn-success" disabled>
                            <span class="icon">‚ñ∂Ô∏è</span> Start Attendance
                        </button>
                        <button id="stopAttendance" class="btn-danger" disabled>
                            <span class="icon">‚èπÔ∏è</span> Stop Attendance
                        </button>
                    </div>

                    <div class="card" style="margin-top: 15px; padding: 15px; background: #e3f2fd;">
                        <h4 style="color: #1976d2; margin-bottom: 10px; font-size: 1em;">üì± Camera Not Working?</h4>
                        <details style="cursor: pointer;">
                            <summary style="font-weight: 600; color: #333; margin-bottom: 10px;">Click here for platform-specific help</summary>
                            <div style="margin-top: 10px; font-size: 0.9em; color: #555;">
                                <p style="margin-bottom: 10px;"><strong>üçé Mac Users:</strong></p>
                                <ol style="margin-left: 20px; margin-bottom: 15px;">
                                    <li>Open System Settings ‚Üí Privacy & Security</li>
                                    <li>Click "Camera" in the sidebar</li>
                                    <li>Enable your browser (Chrome, Safari, Firefox)</li>
                                    <li>Restart your browser</li>
                                    <li>Refresh this page</li>
                                </ol>
                                
                                <p style="margin-bottom: 10px;"><strong>ü™ü Windows Users:</strong></p>
                                <ol style="margin-left: 20px; margin-bottom: 15px;">
                                    <li>Open Settings ‚Üí Privacy ‚Üí Camera</li>
                                    <li>Enable "Allow apps to access camera"</li>
                                    <li>Enable "Allow desktop apps to access camera"</li>
                                    <li>Restart your browser</li>
                                </ol>
                                
                                <p style="margin-bottom: 10px;"><strong>üåê Browser Permissions:</strong></p>
                                <ol style="margin-left: 20px;">
                                    <li>Click the üîí lock icon in address bar</li>
                                    <li>Find "Camera" permissions</li>
                                    <li>Select "Allow"</li>
                                    <li>Refresh the page</li>
                                </ol>
                            </div>
                        </details>
                    </div>
                </div>

                <div class="card" style="margin-top: 20px;">
                    <h2><span class="icon">üìä</span> Attendance Summary</h2>
                    
                    <div class="stats">
                        <div class="stat-card">
                            <h3 id="totalCount">0</h3>
                            <p>Total Students</p>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">
                            <h3 id="presentCount">0</h3>
                            <p>Present</p>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);">
                            <h3 id="absentCount">0</h3>
                            <p>Absent</p>
                        </div>
                    </div>

                    <div class="controls" style="margin-top: 20px;">
                        <button id="downloadReport" class="btn-primary" disabled>
                            <span class="icon">üíæ</span> Download CSV Report
                        </button>
                        <button id="resetAttendance" class="btn-warning" disabled>
                            <span class="icon">üîÑ</span> Reset Attendance
                        </button>
                    </div>

                    <div class="attendance-lists" id="attendanceLists">
                        <div class="attendance-list present">
                            <h3>‚úÖ Present</h3>
                            <div id="presentList">
                                <div class="empty-state">
                                    <div class="icon">‚è≥</div>
                                    <p>No one marked present yet</p>
                                </div>
                            </div>
                        </div>
                        <div class="attendance-list absent">
                            <h3>‚ùå Absent</h3>
                            <div id="absentList">
                                <div class="empty-state">
                                    <div class="icon">‚è≥</div>
                                    <p>Upload photos first</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // System State
        let modelsLoaded = false;
        let cameraRunning = false;
        let attendanceActive = false;
        let students = [];
        let attendanceRecords = {};
        let markedToday = new Set();
        let detectionCount = 0;

        // DOM Elements
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const uploadZone = document.getElementById('uploadZone');
        const fileInput = document.getElementById('fileInput');
        const uploadedPhotos = document.getElementById('uploadedPhotos');
        const trainBtn = document.getElementById('trainBtn');
        const clearBtn = document.getElementById('clearBtn');
        const startAttendanceBtn = document.getElementById('startAttendance');
        const stopAttendanceBtn = document.getElementById('stopAttendance');
        const downloadReportBtn = document.getElementById('downloadReport');
        const resetAttendanceBtn = document.getElementById('resetAttendance');
        const activityLog = document.getElementById('activityLog');
        const systemStatus = document.getElementById('systemStatus');
        const trainingProgress = document.getElementById('trainingProgress');
        const progressFill = document.getElementById('progressFill');
        const detectionOverlay = document.getElementById('detectionOverlay');

        // Load Face-API Models
        async function loadModels() {
            try {
                addLog('‚è≥ Loading AI models...', 'info');
                const MODEL_URL = 'https://cdn.jsdelivr.net/npm/@vladmandic/face-api@1.7.12/model/';
                
                await Promise.all([
                    faceapi.nets.ssdMobilenetv1.loadFromUri(MODEL_URL),
                    faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL),
                    faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL)
                ]);
                
                modelsLoaded = true;
                systemStatus.className = 'status ready';
                systemStatus.innerHTML = '<span class="icon">‚úÖ</span> AI Models Loaded Successfully! Upload photos to begin.';
                addLog('‚úÖ AI models loaded successfully!', 'success');
            } catch (error) {
                systemStatus.className = 'status error';
                systemStatus.innerHTML = '<span class="icon">‚ùå</span> Failed to load AI models: ' + error.message;
                addLog('‚ùå Error loading models: ' + error.message, 'error');
            }
        }

        // Upload Zone Events
        uploadZone.addEventListener('click', () => fileInput.click());
        
        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('dragover');
        });

        uploadZone.addEventListener('dragleave', () => {
            uploadZone.classList.remove('dragover');
        });

        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        });

        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        // Handle File Upload
        async function handleFiles(files) {
            addLog(`üì§ Uploading ${files.length} photos...`, 'info');
            
            for (let file of files) {
                if (!file.type.startsWith('image/')) continue;

                const reader = new FileReader();
                reader.onload = async (e) => {
                    const img = new Image();
                    img.onload = () => {
                        const filename = file.name.replace(/\.(jpg|jpeg|png|gif)$/i, '');
                        const parts = filename.split('_');
                        const id = parts[0] || 'Unknown';
                        const name = parts.slice(1).join(' ') || 'Unknown';

                        students.push({
                            id: id,
                            name: name,
                            image: e.target.result,
                            descriptor: null,
                            trained: false
                        });

                        updateUploadedPhotos();
                        trainBtn.disabled = false;
                        addLog(`‚úÖ Uploaded: ID ${id} - ${name}`, 'success');
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }

            fileInput.value = '';
            updateWorkflowStep(1);
        }

        // Update Uploaded Photos Display
        function updateUploadedPhotos() {
            if (students.length === 0) {
                uploadedPhotos.innerHTML = '';
                return;
            }

            uploadedPhotos.innerHTML = students.map((student, index) => `
                <div class="photo-card">
                    <img src="${student.image}" alt="${student.name}">
                    <div class="id">ID: ${student.id}</div>
                    <div class="name">${student.name}</div>
                    ${student.trained ? '<div style="color: #28a745; font-size: 0.8em;">‚úÖ Trained</div>' : ''}
                </div>
            `).join('');
        }

        // Train AI on Photos
        async function trainOnPhotos() {
            if (!modelsLoaded) {
                alert('AI models not loaded yet. Please wait...');
                return;
            }

            addLog('üéì Starting training on uploaded photos...', 'info');
            trainBtn.disabled = true;
            trainingProgress.style.display = 'block';
            updateWorkflowStep(2);

            let trained = 0;
            let failed = 0;

            for (let i = 0; i < students.length; i++) {
                const student = students[i];
                
                try {
                    const img = await loadImage(student.image);
                    
                    // Use more lenient detection for training
                    const detection = await faceapi
                        .detectSingleFace(img, new faceapi.SsdMobilenetv1Options({ minConfidence: 0.2 }))
                        .withFaceLandmarks()
                        .withFaceDescriptor();

                    if (detection) {
                        student.descriptor = detection.descriptor;
                        student.trained = true;
                        trained++;
                        addLog(`‚úÖ Trained: ID ${student.id} - ${student.name}`, 'success');
                    } else {
                        failed++;
                        addLog(`‚ùå No face detected in photo: ID ${student.id} - ${student.name}`, 'error');
                    }
                } catch (error) {
                    failed++;
                    addLog(`‚ùå Error training ID ${student.id}: ${error.message}`, 'error');
                }

                const progress = Math.round(((i + 1) / students.length) * 100);
                progressFill.style.width = progress + '%';
                progressFill.textContent = progress + '%';
            }

            addLog(`üéì Training complete: ${trained} successfully trained, ${failed} failed`, trained > 0 ? 'success' : 'error');
            
            if (trained > 0) {
                startAttendanceBtn.disabled = false;
                initializeAttendance();
                updateWorkflowStep(3);
                addLog(`‚úÖ System ready! ${trained} faces enrolled. Click "Start Attendance" to begin.`, 'success');
            } else {
                addLog('‚ùå No faces could be trained. Please check your photos.', 'error');
            }

            updateUploadedPhotos();
            trainBtn.disabled = false;
        }

        // Helper: Load Image
        function loadImage(src) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = () => resolve(img);
                img.onerror = reject;
                img.src = src;
            });
        }

        // Initialize Attendance Records
        function initializeAttendance() {
            attendanceRecords = {};
            students.forEach(student => {
                if (student.trained) {
                    attendanceRecords[student.id] = {
                        name: student.name,
                        status: 'Absent',
                        time: ''
                    };
                }
            });
            updateAttendanceDisplay();
            downloadReportBtn.disabled = false;
            resetAttendanceBtn.disabled = false;
        }

        // Test Camera Access (called before starting attendance)
        async function testCameraAccess() {
            addLog('üß™ Testing camera access...', 'info');
            
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                
                // Camera works! Stop it immediately
                stream.getTracks().forEach(track => track.stop());
                
                addLog('‚úÖ Camera test successful!', 'success');
                return true;
            } catch (error) {
                addLog('‚ùå Camera test failed: ' + error.name, 'error');
                return false;
            }
        }

        // Detect OS and Browser
        function detectPlatform() {
            const ua = navigator.userAgent;
            const platform = navigator.platform;
            
            const info = {
                isMac: /Mac|iPhone|iPad|iPod/.test(platform) || /Macintosh/.test(ua),
                isWindows: /Win/.test(platform),
                isLinux: /Linux/.test(platform),
                isSafari: /Safari/.test(ua) && !/Chrome/.test(ua),
                isChrome: /Chrome/.test(ua),
                isFirefox: /Firefox/.test(ua),
                isEdge: /Edg/.test(ua)
            };
            
            return info;
        }

        // Start Attendance with Cross-Platform Support
        async function startAttendance() {
            const platform = detectPlatform();
            
            addLog('üì∑ Requesting camera access...', 'info');
            addLog(`üñ•Ô∏è Platform: ${platform.isMac ? 'Mac' : platform.isWindows ? 'Windows' : platform.isLinux ? 'Linux' : 'Unknown'}`, 'info');
            addLog(`üåê Browser: ${platform.isSafari ? 'Safari' : platform.isChrome ? 'Chrome' : platform.isFirefox ? 'Firefox' : platform.isEdge ? 'Edge' : 'Unknown'}`, 'info');
            
            // Check if getUserMedia is supported
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                addLog('‚ùå Camera API not supported in this browser', 'error');
                alert('Your browser doesn\'t support camera access.\n\nPlease use:\n‚Ä¢ Chrome\n‚Ä¢ Firefox\n‚Ä¢ Safari (latest version)\n‚Ä¢ Edge');
                return;
            }

            // Try multiple constraint configurations for compatibility
            const constraintSets = [
                // Most compatible - works on all platforms
                { 
                    video: { 
                        facingMode: 'user'
                    } 
                },
                // Good quality - works on most modern devices
                { 
                    video: { 
                        width: { ideal: 640 },
                        height: { ideal: 480 },
                        facingMode: 'user'
                    } 
                },
                // High quality - may fail on older devices
                { 
                    video: { 
                        width: { ideal: 1280 },
                        height: { ideal: 720 },
                        facingMode: 'user'
                    } 
                },
                // Minimal - absolute fallback
                { 
                    video: true 
                }
            ];

            let stream = null;
            let successIndex = -1;

            // Try each constraint set until one works
            for (let i = 0; i < constraintSets.length; i++) {
                try {
                    addLog(`üîÑ Trying camera configuration ${i + 1}/${constraintSets.length}...`, 'info');
                    stream = await navigator.mediaDevices.getUserMedia(constraintSets[i]);
                    successIndex = i;
                    addLog(`‚úÖ Camera configuration ${i + 1} successful!`, 'success');
                    break;
                } catch (err) {
                    addLog(`‚ö†Ô∏è Configuration ${i + 1} failed: ${err.name}`, 'error');
                    
                    if (i === constraintSets.length - 1) {
                        // All attempts failed
                        addLog('‚ùå All camera configurations failed', 'error');
                        
                        let errorMessage = 'Unable to access camera.\n\n';
                        
                        if (err.name === 'NotAllowedError' || err.name === 'PermissionDeniedError') {
                            errorMessage += 'PERMISSION DENIED\n\n';
                            if (platform.isMac) {
                                errorMessage += 'Mac users:\n';
                                errorMessage += '1. Open System Settings\n';
                                errorMessage += '2. Go to Privacy & Security\n';
                                errorMessage += '3. Click Camera\n';
                                errorMessage += '4. Enable for your browser\n';
                                errorMessage += '5. Restart browser\n';
                            } else if (platform.isWindows) {
                                errorMessage += 'Windows users:\n';
                                errorMessage += '1. Open Settings\n';
                                errorMessage += '2. Go to Privacy\n';
                                errorMessage += '3. Click Camera\n';
                                errorMessage += '4. Enable "Allow apps to access camera"\n';
                                errorMessage += '5. Restart browser\n';
                            } else {
                                errorMessage += '1. Check browser permissions\n';
                                errorMessage += '2. Click lock icon in address bar\n';
                                errorMessage += '3. Allow camera access\n';
                                errorMessage += '4. Refresh page\n';
                            }
                        } else if (err.name === 'NotFoundError' || err.name === 'DevicesNotFoundError') {
                            errorMessage += 'NO CAMERA FOUND\n\n';
                            errorMessage += '1. Check camera is connected\n';
                            errorMessage += '2. Close other apps using camera\n';
                            errorMessage += '3. Try external webcam if available\n';
                        } else if (err.name === 'NotReadableError' || err.name === 'TrackStartError') {
                            errorMessage += 'CAMERA IN USE\n\n';
                            errorMessage += '1. Close other apps/tabs using camera\n';
                            errorMessage += '2. Restart browser\n';
                            errorMessage += '3. Restart computer if needed\n';
                        } else {
                            errorMessage += 'Error: ' + err.message + '\n\n';
                            errorMessage += '1. Refresh page and try again\n';
                            errorMessage += '2. Try different browser\n';
                            errorMessage += '3. Check camera is working\n';
                        }
                        
                        alert(errorMessage);
                        return;
                    }
                }
            }
            
            if (!stream) {
                addLog('‚ùå Failed to get camera stream', 'error');
                return;
            }

            try {
                // Set video source
                video.srcObject = stream;
                addLog('‚úÖ Camera stream connected!', 'success');
                
                // Wait for metadata to load
                await new Promise((resolve, reject) => {
                    video.onloadedmetadata = () => {
                        canvas.width = video.videoWidth;
                        canvas.height = video.videoHeight;
                        addLog(`üìê Camera resolution: ${video.videoWidth}x${video.videoHeight}`, 'info');
                        resolve();
                    };
                    video.onerror = reject;
                    
                    // Timeout after 10 seconds
                    setTimeout(() => reject(new Error('Video metadata timeout')), 10000);
                });

                // Play video (required for some browsers, especially Safari)
                try {
                    await video.play();
                    addLog('‚ñ∂Ô∏è Video playback started', 'success');
                } catch (playError) {
                    addLog('‚ö†Ô∏è Auto-play warning: ' + playError.message, 'error');
                    // Continue anyway - some browsers don't need explicit play
                }
                
                cameraRunning = true;
                attendanceActive = true;
                startAttendanceBtn.disabled = true;
                stopAttendanceBtn.disabled = false;
                trainBtn.disabled = true;
                detectionOverlay.style.display = 'block';
                
                addLog('üîç Face detection started! Position yourself in front of the camera.', 'success');
                addLog(`üìä Detection threshold: 0.7 (lower = more lenient)`, 'info');
                updateWorkflowStep(3);
                
                // Wait for video to be fully ready before starting detection
                addLog('‚è≥ Waiting for camera to stabilize...', 'info');
                setTimeout(() => {
                    addLog('üé¨ Starting face detection now!', 'success');
                    detectFaces();
                }, 2000);
                
            } catch (error) {
                addLog('‚ùå Error setting up video: ' + error.message, 'error');
                
                // Clean up stream
                if (stream) {
                    stream.getTracks().forEach(track => track.stop());
                }
                
                alert('Error setting up camera: ' + error.message + '\n\nPlease refresh and try again.');
            }
        }

        // Stop Attendance
        function stopAttendance() {
            addLog('‚èπÔ∏è Stopping attendance...', 'info');
            
            // Stop all video tracks
            if (video.srcObject) {
                const tracks = video.srcObject.getTracks();
                tracks.forEach(track => {
                    track.stop();
                    addLog(`üõë Stopped track: ${track.kind}`, 'info');
                });
                video.srcObject = null;
            }
            
            // Pause video element
            try {
                video.pause();
            } catch (e) {
                // Ignore pause errors
            }
            
            cameraRunning = false;
            attendanceActive = false;
            startAttendanceBtn.disabled = false;
            stopAttendanceBtn.disabled = true;
            trainBtn.disabled = false;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            detectionOverlay.style.display = 'none';
            
            addLog('‚úÖ Attendance stopped. Total detections run: ' + detectionCount, 'success');
            addLog('üìä Camera released successfully', 'info');
            updateWorkflowStep(4);
        }

        // Detect Faces
        async function detectFaces() {
            if (!attendanceActive || !cameraRunning) {
                addLog('‚ö†Ô∏è Detection stopped - attendance inactive', 'error');
                return;
            }

            // Skip detection if page is hidden (user switched tabs)
            if (document.hidden) {
                setTimeout(detectFaces, 2000);
                return;
            }

            detectionCount++;
            const debugInfo = [];
            debugInfo.push(`Detection #${detectionCount}`);

            try {
                // Check if video is ready
                if (video.readyState !== video.HAVE_ENOUGH_DATA) {
                    debugInfo.push('‚è≥ Waiting for video...');
                    updateDebugOverlay(debugInfo);
                    setTimeout(detectFaces, 500);
                    return;
                }

                debugInfo.push('üìπ Video ready');
                
                // Run detection with very lenient settings
                const detections = await faceapi
                    .detectAllFaces(video, new faceapi.SsdMobilenetv1Options({ 
                        minConfidence: 0.2  // Very low threshold
                    }))
                    .withFaceLandmarks()
                    .withFaceDescriptors();

                debugInfo.push(`üëÅÔ∏è Faces detected: ${detections.length}`);

                ctx.clearRect(0, 0, canvas.width, canvas.height);

                if (detections.length > 0) {
                    addLog(`üëÅÔ∏è Detected ${detections.length} face(s) in frame #${detectionCount}`, 'success');
                    
                    for (let i = 0; i < detections.length; i++) {
                        const detection = detections[i];
                        const box = detection.detection.box;
                        let matchedStudent = null;
                        let bestDistance = 2.0;
                        let allDistances = [];

                        // Find best match
                        students.forEach(student => {
                            if (student.trained && student.descriptor) {
                                const distance = faceapi.euclideanDistance(student.descriptor, detection.descriptor);
                                allDistances.push({ student, distance });
                                if (distance < 0.7 && distance < bestDistance) { // Very lenient threshold
                                    bestDistance = distance;
                                    matchedStudent = student;
                                }
                            }
                        });

                        // Sort to show best matches
                        allDistances.sort((a, b) => a.distance - b.distance);
                        const top3 = allDistances.slice(0, 3);
                        
                        debugInfo.push(`Face ${i+1} best matches:`);
                        top3.forEach((item, idx) => {
                            debugInfo.push(`  ${idx+1}. ${item.student.id}-${item.student.name}: ${item.distance.toFixed(3)}`);
                        });

                        let color = '#ff0000';
                        let label = 'Unknown';

                        if (matchedStudent) {
                            color = '#00ff00';
                            label = `${matchedStudent.id} - ${matchedStudent.name}`;
                            const confidence = ((1 - bestDistance) * 100).toFixed(1);
                            
                            addLog(`‚úÖ MATCH! ${label} (distance: ${bestDistance.toFixed(3)}, confidence: ${confidence}%)`, 'success');

                            // Mark attendance
                            if (!markedToday.has(matchedStudent.id)) {
                                markAttendance(matchedStudent.id);
                            }
                        } else {
                            addLog(`‚ùå No match for face ${i+1} (best distance: ${bestDistance.toFixed(3)})`, 'error');
                        }

                        // Draw box
                        ctx.strokeStyle = color;
                        ctx.lineWidth = 4;
                        ctx.strokeRect(box.x, box.y, box.width, box.height);

                        // Draw label
                        ctx.fillStyle = color;
                        ctx.fillRect(box.x, box.y - 40, box.width, 40);
                        ctx.fillStyle = '#fff';
                        ctx.font = 'bold 16px Arial';
                        ctx.fillText(label, box.x + 5, box.y - 12);
                    }
                } else {
                    addLog(`‚ö†Ô∏è No faces detected in frame #${detectionCount}`, 'error');
                    debugInfo.push('‚ö†Ô∏è Try: better lighting, face camera, remove glasses');
                }
            } catch (error) {
                addLog('‚ùå Detection error: ' + error.message, 'error');
                debugInfo.push('‚ùå Error: ' + error.message);
            }

            updateDebugOverlay(debugInfo);

            // Run detection every 2 seconds
            setTimeout(detectFaces, 2000);
        }

        // Update Debug Overlay
        function updateDebugOverlay(lines) {
            detectionOverlay.innerHTML = '<div><strong>Detection Info:</strong></div>' + 
                lines.map(line => `<div>${line}</div>`).join('');
        }

        // Mark Attendance
        function markAttendance(id) {
            const time = new Date().toLocaleTimeString();
            attendanceRecords[id].status = 'Present';
            attendanceRecords[id].time = time;
            markedToday.add(id);
            
            addLog(`üéâ ATTENDANCE MARKED: ${attendanceRecords[id].name} (ID: ${id}) at ${time}`, 'success');
            updateAttendanceDisplay();
        }

        // Update Attendance Display
        function updateAttendanceDisplay() {
            const total = Object.keys(attendanceRecords).length;
            const present = Object.values(attendanceRecords).filter(r => r.status === 'Present').length;
            const absent = total - present;

            document.getElementById('totalCount').textContent = total;
            document.getElementById('presentCount').textContent = present;
            document.getElementById('absentCount').textContent = absent;

            // Present List
            const presentList = document.getElementById('presentList');
            const presentStudents = Object.entries(attendanceRecords).filter(([id, r]) => r.status === 'Present');
            
            if (presentStudents.length === 0) {
                presentList.innerHTML = '<div class="empty-state"><div class="icon">‚è≥</div><p>No one marked present yet</p></div>';
            } else {
                presentList.innerHTML = presentStudents.map(([id, record]) => `
                    <div class="person">
                        <div class="icon">‚úÖ</div>
                        <div class="info">
                            <div class="id">ID: ${id}</div>
                            <div class="name">${record.name}</div>
                            <div class="time">${record.time}</div>
                        </div>
                    </div>
                `).join('');
            }

            // Absent List
            const absentList = document.getElementById('absentList');
            const absentStudents = Object.entries(attendanceRecords).filter(([id, r]) => r.status === 'Absent');
            
            if (absentStudents.length === 0) {
                absentList.innerHTML = '<div class="empty-state"><div class="icon">üéâ</div><p>Everyone is present!</p></div>';
            } else {
                absentList.innerHTML = absentStudents.map(([id, record]) => `
                    <div class="person">
                        <div class="icon">‚ùå</div>
                        <div class="info">
                            <div class="id">ID: ${id}</div>
                            <div class="name">${record.name}</div>
                        </div>
                    </div>
                `).join('');
            }
        }

        // Download Report
        function downloadReport() {
            const date = new Date().toLocaleDateString();
            let csv = 'ID,Name,Status,Time,Date\n';
            
            Object.entries(attendanceRecords).forEach(([id, record]) => {
                csv += `${id},${record.name},${record.status},${record.time || 'N/A'},${date}\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `attendance_${date.replace(/\//g, '-')}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
            
            addLog('üíæ Attendance report downloaded', 'success');
        }

        // Reset Attendance
        function resetAttendance() {
            if (confirm('Reset attendance for all students?')) {
                Object.keys(attendanceRecords).forEach(id => {
                    attendanceRecords[id].status = 'Absent';
                    attendanceRecords[id].time = '';
                });
                markedToday.clear();
                updateAttendanceDisplay();
                addLog('üîÑ Attendance reset', 'info');
            }
        }

        // Clear All
        function clearAll() {
            if (confirm('Delete all uploaded photos and reset everything?')) {
                students = [];
                attendanceRecords = {};
                markedToday.clear();
                uploadedPhotos.innerHTML = '';
                trainBtn.disabled = true;
                startAttendanceBtn.disabled = true;
                downloadReportBtn.disabled = true;
                resetAttendanceBtn.disabled = true;
                trainingProgress.style.display = 'none';
                updateAttendanceDisplay();
                addLog('üóëÔ∏è All data cleared', 'info');
                updateWorkflowStep(1);
            }
        }

        // Update Workflow Step
        function updateWorkflowStep(step) {
            for (let i = 1; i <= 4; i++) {
                const stepEl = document.getElementById(`step${i}`);
                if (i <= step) {
                    stepEl.classList.add('active');
                } else {
                    stepEl.classList.remove('active');
                }
            }
        }

        // Add Log Entry
        function addLog(message, type = 'info') {
            const time = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.textContent = `[${time}] ${message}`;
            activityLog.insertBefore(logEntry, activityLog.firstChild);

            while (activityLog.children.length > 50) {
                activityLog.removeChild(activityLog.lastChild);
            }
        }

        // Event Listeners
        trainBtn.addEventListener('click', trainOnPhotos);
        clearBtn.addEventListener('click', clearAll);
        startAttendanceBtn.addEventListener('click', startAttendance);
        stopAttendanceBtn.addEventListener('click', stopAttendance);
        downloadReportBtn.addEventListener('click', downloadReport);
        resetAttendanceBtn.addEventListener('click', resetAttendance);

        // Handle page visibility changes (when user switches tabs)
        document.addEventListener('visibilitychange', () => {
            if (document.hidden && attendanceActive) {
                addLog('‚è∏Ô∏è Tab hidden - detection paused to save resources', 'info');
            } else if (!document.hidden && attendanceActive) {
                addLog('‚ñ∂Ô∏è Tab visible - detection resumed', 'info');
            }
        });

        // Handle before unload (warn if attendance is active)
        window.addEventListener('beforeunload', (e) => {
            if (attendanceActive) {
                e.preventDefault();
                e.returnValue = 'Attendance is still running. Are you sure you want to leave?';
                return e.returnValue;
            }
        });

        // Check HTTPS requirement
        function checkSecureContext() {
            const isLocalhost = window.location.hostname === 'localhost' || 
                              window.location.hostname === '127.0.0.1' ||
                              window.location.protocol === 'file:';
            
            const isHTTPS = window.location.protocol === 'https:';
            
            if (!isLocalhost && !isHTTPS) {
                // Not secure and not localhost - camera won't work!
                systemStatus.className = 'status error';
                systemStatus.innerHTML = '<span class="icon">üîí</span> INSECURE CONNECTION! Camera access requires HTTPS.';
                
                addLog('‚ùå CRITICAL: This page is NOT using HTTPS!', 'error');
                addLog('‚ö†Ô∏è Camera will NOT work without HTTPS (secure connection)', 'error');
                addLog('üìå Current URL: ' + window.location.href, 'error');
                
                // Show big warning
                const warningDiv = document.createElement('div');
                warningDiv.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: #dc3545;
                    color: white;
                    padding: 30px;
                    border-radius: 15px;
                    box-shadow: 0 10px 50px rgba(0,0,0,0.5);
                    z-index: 10000;
                    max-width: 500px;
                    text-align: center;
                `;
                
                warningDiv.innerHTML = `
                    <h2 style="margin-bottom: 20px;">üîí INSECURE CONNECTION</h2>
                    <p style="margin-bottom: 15px; font-size: 1.1em;">
                        This page is accessed via <strong>HTTP</strong> (not HTTPS).
                        <br><br>
                        Browsers BLOCK camera access on insecure connections for your safety.
                    </p>
                    <h3 style="margin-top: 20px; margin-bottom: 15px;">‚úÖ How to Fix:</h3>
                    <ol style="text-align: left; margin: 0 auto; max-width: 400px; line-height: 1.8;">
                        <li><strong>GitHub Pages</strong> (Free HTTPS):
                            <br>‚Üí Upload to github.io
                        </li>
                        <li><strong>Netlify Drop</strong> (Instant):
                            <br>‚Üí Drop file at netlify.com/drop
                        </li>
                        <li><strong>Run Locally</strong>:
                            <br>‚Üí Open HTML file directly from computer
                        </li>
                        <li><strong>Use HTTPS</strong>:
                            <br>‚Üí Change URL from http:// to https://
                        </li>
                    </ol>
                    <button onclick="this.parentElement.remove()" style="
                        margin-top: 20px;
                        padding: 12px 30px;
                        background: white;
                        color: #dc3545;
                        border: none;
                        border-radius: 8px;
                        font-weight: bold;
                        cursor: pointer;
                        font-size: 1em;
                    ">I Understand</button>
                `;
                
                document.body.appendChild(warningDiv);
                
                return false;
            } else {
                if (isHTTPS) {
                    addLog('üîí Secure connection (HTTPS) detected - camera will work!', 'success');
                } else {
                    addLog('üíª Running locally - camera should work', 'success');
                }
                return true;
            }
        }

        // Initialize
        window.addEventListener('load', () => {
            loadModels();
            addLog('üöÄ System starting up...', 'info');
            
            // Check HTTPS FIRST
            const isSecure = checkSecureContext();
            
            // Detect and log platform
            const platform = detectPlatform();
            let platformName = 'Unknown';
            if (platform.isMac) platformName = 'macOS';
            else if (platform.isWindows) platformName = 'Windows';
            else if (platform.isLinux) platformName = 'Linux';
            
            let browserName = 'Unknown';
            if (platform.isSafari) browserName = 'Safari';
            else if (platform.isChrome) browserName = 'Chrome';
            else if (platform.isFirefox) browserName = 'Firefox';
            else if (platform.isEdge) browserName = 'Edge';
            
            addLog(`üíª Running on: ${platformName} - ${browserName}`, 'info');
            addLog(`üåê URL: ${window.location.href}`, 'info');
            
            // Safari-specific warnings
            if (platform.isSafari) {
                addLog('‚ö†Ô∏è Safari detected: Ensure camera permissions are enabled in System Settings', 'error');
            }
            
            // Check if camera API is available
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                if (isSecure) {
                    addLog('‚úÖ Camera API supported on this browser', 'success');
                }
            } else {
                addLog('‚ùå Camera API not supported - please use a modern browser', 'error');
                systemStatus.className = 'status error';
                systemStatus.innerHTML = '<span class="icon">‚ùå</span> Browser not supported. Please use Chrome, Firefox, Safari, or Edge.';
            }
        });
    </script>
</body>
</html>